<!-- include the stylesheet -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" crossorigin="anonymous">

<mat-toolbar>
  <mat-toolbar-row>
    <button mat-icon-button [matMenuTriggerFor]="menu">
      <mat-icon>menu</mat-icon>
    </button>
    <mat-menu #menu="matMenu">
      <button mat-menu-item [matMenuTriggerFor]="fileMenu">File</button>
      <mat-menu #fileMenu="matMenu">
        <!-- TODO add keyboard shortcuts for the menu items below -->
        <button mat-menu-item (click)="openDirectory()">Open Directory</button>
        <button mat-menu-item (click)="newNote()">New Note</button>
        <button mat-menu-item (click)="saveAllNotes()">Save</button>
        <button mat-menu-item (click)="saveAsAllNotes()">Save As</button>
        <button mat-menu-item (click)="clearNotes()">Clear Notes</button>
      </mat-menu>
      <button mat-menu-item [matMenuTriggerFor]="editMenu">Edit</button>
      <mat-menu #editMenu="matMenu">
        <!-- TODO add keyboard shortcuts for the items below -->
        <button mat-menu-item (click)="undo()">Undo</button>
        <button mat-menu-item (click)="redo()">Redo</button>
        <button mat-menu-item (click)="cut()">Cut</button>
        <button mat-menu-item (click)="copy()">Copy</button>
        <button mat-menu-item (click)="paste()">Paste</button>
        <!-- TODO make the edit menu - all of these actions need to be implemented. Add any additional actions you want to the menu. -->
      </mat-menu>
      <button mat-menu-item [matMenuTriggerFor]="viewMenu">View</button>
      <mat-menu #viewMenu="matMenu">
        <button mat-menu-item (click)="appearanceMenu()">Appearance</button>
        <button mat-menu-item (click)="toggleFullScreen()">Toggle Full Screen</button>
        <!-- TODO make the view menu - all of these actions need to be implemented. Add any additional actions you want to the menu. -->
      </mat-menu>
      <button mat-menu-item (click)="openPreferencesMenu()">Preferences</button>
      <!-- the preferences menu is in app-preferences. Open it by calling openPreferencesMenu() -->
      <button mat-menu-item (click)="openHelpMenu()">Help</button>
    </mat-menu>
    <span>Jotmark</span>
    <span class="fill-remaining-space"></span>
    <!-- on the right hand side of the toolbar, add a button that refreshes the notes list -->
    <button mat-icon-button (click)="refreshNotes()">
      <mat-icon>refresh</mat-icon>
    </button>
    <span class="spacer"></span>
  </mat-toolbar-row>
</mat-toolbar>

<div class="main-ui">
  <div class="notes-list" style="display: flex; flex-wrap: wrap; z-index: 1;">
  <ng-container *ngFor="let note of notes"> <!-- changed from notes to filtered notes to enable search as well as tag filtering -->
    <mat-card class="note-card">
      <!-- include the content in a div with a max height and overflow scroll -->
      <div style="max-height: 200px; overflow: auto">
        <div style="background: #e8e8e8; padding: 5px; border-radius: 5px;">
          <mat-card-title>{{note.name}}</mat-card-title>
          <!-- convert last modified date to a string and add as a subtitle -->
          <!-- Right now, the tag UI is always at the bottom of the note card but is in the same scrollable area as the note content. -->
          <!-- we want this to be locked to the bottom of the note card, so that it doesn't scroll with the note content. -->
        </div>
      <mat-card-content (click)="handleNoteClick(note, $event)"> <!-- moved from the note card to the content so it does not interfere with tags -->
        <div [innerHTML]="parseAndRender(note.content)" style="overflow: auto"></div>
      </mat-card-content>
      </div>
      <mat-card-footer>
        <mat-card-actions>
          <button mat-icon-button (click)="deleteNoteByIndex($event, notes.indexOf(note))">
            <mat-icon>delete</mat-icon>
          </button>
          <ng-container *ngFor="let tag of note.tags">
            <mat-chip (click)="filterByTag(tag)" color="primary">{{tag}}
              <mat-icon (click)="removeTagFromNoteByIndex(note, $event, note.tags.indexOf(tag))" matChipRemove>cancel</mat-icon>
            </mat-chip>
          </ng-container>
          <button mat-icon-button [matMenuTriggerFor]="tagMenu">
            <mat-icon>add</mat-icon>
          </button>
          <mat-menu #tagMenu="matMenu">
            <!-- make a button for adding a new tag to the note that calls addTagToNote() -->
            <!-- on click it should open a material design dialog that asks for the tag name -->
            <button mat-menu-item (click)="addNewTagToNote(note)">Add Tag</button>
            <!-- for each tag in the tags list, add a menu item that adds the tag to the note -->
            <ng-container *ngFor="let tag of totalTags">
              <button mat-menu-item (click)="addTagToNote(note, tag)">{{tag}}</button>
            </ng-container>
          </mat-menu>
        </mat-card-actions>
      </mat-card-footer>
    </mat-card>
  </ng-container>
  </div>
  <div class="editor" style="position: fixed; z-index: 2;">
    <app-editor *ngIf="selectedNote" [note]="selectedNote"></app-editor>
  </div>
</div>
